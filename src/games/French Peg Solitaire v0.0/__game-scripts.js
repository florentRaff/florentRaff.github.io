var gl=pc.createScript("game_logic");gl.attributes.add("gridBlockMaterials",{type:"asset",assetType:"material",array:!0,title:"gridBlockMaterials"}),gl.attributes.add("mainCam",{type:"entity",default:null}),gl.attributes.add("marbleTemplateId",{type:"number",default:91480630}),gl.attributes.add("gridBlockId",{type:"number",default:92322602}),gl.prototype.setupAndLocalVariables=function(){this.clickedMarble={},this.currentScannedBlock={},this.previousScannedBlock={},this.currentScannedMarble={},this.previousScannedMarble={},this.lastBlock={},this.nextBlockCandidate={},this.mousePos=[0,0],this.mouseClickRaycastResult={},this.firstMoveMade=!1,this.gridBlocks=new Array(7).fill({}).map((()=>new Array(7).fill({}))),this.marbleInstances=new Array(37).fill({}),this.marbleTemplate=this.app.assets.get(this.marbleTemplateId),this.blockTemplate=this.app.assets.get(this.gridBlockId);for(let t=0,e=0;t<7;t++)for(let i=0;i<7;i++)this.checkIfGridSpotUsable(t,i)?(this.marbleInstances[e]=this.marbleTemplate.resource.instantiate(),this.app.root.addChild(this.marbleInstances[e]),this.marbleInstances[e].name="marble_"+e,this.marbleInstances[e].script.marble.id=e,this.marbleInstances[e].script.marble.col=i,this.marbleInstances[e].script.marble.row=t,this.marbleInstances[e].script.marble.isSet=!0,this.marbleInstances[e].setPosition(i-3,.25,t-3),this.gridBlocks[t][i]=this.blockTemplate.resource.instantiate(),this.app.root.addChild(this.gridBlocks[t][i]),this.gridBlocks[t][i].name="gridBlock_row_"+t+"_col_"+i,this.gridBlocks[t][i].setPosition(i-3,.01,t-3),this.gridBlocks[t][i].script.gridBlock.isUsable=!0,this.gridBlocks[t][i].script.gridBlock.isUsed=!0,this.gridBlocks[t][i].script.gridBlock.row=t,this.gridBlocks[t][i].script.gridBlock.col=i,this.gridBlocks[t][i].script.gridBlock.marbleId=e,this.toggleGridBlockChildren(this.gridBlocks[t][i],!1),e++):(this.gridBlocks[t][i]=this.blockTemplate.resource.instantiate(),this.app.root.addChild(this.gridBlocks[t][i]),this.gridBlocks[t][i].name="gridBlock_row_"+t+"_col_"+i,this.gridBlocks[t][i].setPosition(i-3,.01,t-3),this.gridBlocks[t][i].script.gridBlock.isUsable=!1,this.gridBlocks[t][i].collision.enabled=!1,this.toggleGridBlockChildren(this.gridBlocks[t][i],!1),this.gridBlocks[t][i].script.gridBlock.isUsed=!1,this.gridBlocks[t][i].script.gridBlock.row=t,this.gridBlocks[t][i].script.gridBlock.col=i)},gl.prototype.states={state:"gameStart",gameStart:{actions:{onEnter:function(t){},onUpdate:function(t){var e=t.doRaycast(t.mousePos[0],t.mousePos[1]);e.result&&"marble"===e.type?(t.previousScannedMarble=t.currentScannedMarble,t.currentScannedMarble=e.result.entity,0!==Object.entries(t.previousScannedMarble).length&&t.previousScannedMarble.setLocalScale(.5,.5,.5),t.currentScannedMarble.setLocalScale(.55,.55,.55)):e.result&&"gridBlock"===e.type&&0!==Object.entries(t.currentScannedMarble).length&&t.currentScannedMarble.setLocalScale(.5,.5,.5)},onExit:function(t){t.currentScannedMarble.setLocalScale(.5,.5,.5)}},events:{marbleClicked:{target:"idle",action:function(t){t.removeMarble(t.clickedMarble),t.lastBlock.script.gridBlock.isUsed=!1,t.firstMoveMade=!0}},bgClicked:{target:"rotateView",action:function(t){}},gridClicked:{target:"rotateView",action:function(t){}}}},idle:{actions:{onEnter:function(t){},onUpdate:function(t){var e=t.doRaycast(t.mousePos[0],t.mousePos[1]);e.result&&"marble"===e.type?(t.previousScannedMarble=t.currentScannedMarble,t.currentScannedMarble=e.result.entity,0!==Object.entries(t.previousScannedMarble).length&&t.previousScannedMarble.setLocalScale(.5,.5,.5),t.currentScannedMarble.setLocalScale(.55,.55,.55)):e.result&&"gridBlock"===e.type&&0!==Object.entries(t.currentScannedMarble).length&&t.currentScannedMarble.setLocalScale(.5,.5,.5)},onExit:function(t){}},events:{marbleClicked:{target:"marbleSelected",action:function(t){}},bgClicked:{target:"rotateView",action:function(t){}},gridClicked:{target:"rotateView",action:function(t){}},emptySpotClicked:{target:"rotateView",action:function(t){}}}},rotateView:{actions:{onEnter:function(t){},onUpdate:{},onExit:function(t){}},events:{clickReleased:{target:"idle",action:function(t){}},gameStartClickReleased:{target:"gameStart",action:function(t){}}}},marbleSelected:{actions:{onEnter:function(t){t.toggleMarbleColliders(!1)},onUpdate:function(t){var e=t.doRaycast(t.mousePos[0],t.mousePos[1]);e.result&&"gridBlock"===e.type&&(t.previousScannedBlock=t.currentScannedBlock,t.currentScannedBlock=e.result.entity,t.animateCrosshairs(t.lastBlock,t.previousScannedBlock,t.currentScannedBlock,t.clickedMarble,t.gridBlockMaterials[0],t.gridBlockMaterials[1],t.gridBlockMaterials[2]),t.animateMarble(t.clickedMarble,e.result.entity.getPosition(),e.result.point))},onExit:function(t){t.toggleMarbleColliders(!0),t.clickedMarble.setLocalScale(.5,.5,.5),t.turnOffGridBlocksVisibility(),t.returnMarble(t.clickedMarble)}},events:{bgClicked:{target:"idle",action:function(t){t.returnMarble(t.clickedMarble)}},gridClicked:{target:"idle",action:function(t){var e=t.currentScannedBlock,i=t.gridBlocks[t.clickedMarble.script.marble.row][t.clickedMarble.script.marble.col];t.canMarbleMoveHere(i,e)?t.moveMarble(i,e):t.returnMarble(t.clickedMarble),t.anyMovesLeft()||console.log("no more moves left")}}}},noMoreMoves:{default:function(){console.log("not yet setup")}},victory:{default:function(){console.log("not yet setup")}},event:function(t,e){var i=this[this.state];i.events[e]&&(i.actions.onExit(t),i.events[e].action(t),newStateString=i.events[e].target,newState=this[newStateString],newState.actions.onEnter(t),this.state=newStateString)}},gl.prototype.animateMarble=function(t,e,i){e.distance(i)>0?(t.setPosition(i.x,.25,i.z),t.setLocalScale(.5,.5,.5)):(t.setPosition(e.x,.25,e.z),t.setLocalScale(.55,.55,.55))},gl.prototype.animateCrosshairs=function(t,e,i,r,s,o,l){this.toggleGridBlockChildren(t,!0),this.assignMaterialToChildren(t,s),0!==Object.entries(e).length&&this.toggleGridBlockChildren(e,!1),this.toggleGridBlockChildren(i,!0),this.canMarbleMoveHere(t,i)?this.assignMaterialToChildren(i,o):this.assignMaterialToChildren(i,l)},gl.prototype.animateCrosshairsOnStart=function(t,e,i){0!==Object.entries(t).length&&this.toggleGridBlockChildren(t,!1),this.toggleGridBlockChildren(e,!0),this.assignMaterialToChildren(e,i)},gl.prototype.returnMarble=function(t){var e=this.gridBlocks[t.script.marble.row][t.script.marble.col].getPosition();t.setPosition(e.x,.25,e.z)},gl.prototype.toggleGridBlockChildren=function(t,e){var i=t.findComponents("render");for(let t=0;t<i.length;++t)i[t].enabled=e},gl.prototype.assignMaterialToChildren=function(t,e){var i=t.findComponents("render");for(let t=0;t<i.length;++t){var r=i[t].meshInstances;for(let t=0;t<r.length;t++)r[t].material=e.resource}},gl.prototype.canMarbleMoveHere=function(t,e){return!this.currentScannedBlock.script.gridBlock.isUsed&&(!!this.checkIf2SpotsAway(t,e)&&!!this.calculateMiddleBlock(t,e).script.gridBlock.isUsed)},gl.prototype.moveMarble=function(t,e){var i=this.calculateMiddleBlock(t,e);this.marbleInstances[i.script.gridBlock.marbleId];i.script.gridBlock.isUsed=!1,t=t.script.gridBlock,e=e.script.gridBlock,t.isUsed=!1,e.isUsed=!0,e.marbleId=this.clickedMarble.script.marble.id,this.updateMarble(this.clickedMarble,e.row,e.col,!0);var r=this.currentScannedBlock.getPosition();this.clickedMarble.setPosition(r.x,.25,r.z),this.removeMarble(this.marbleInstances[i.script.gridBlock.marbleId])},gl.prototype.removeMarble=function(t){t.collision.enabled=!1,t.render.enabled=!1,t.script.marble.isSet=!1},gl.prototype.updateMarble=function(t,e,i,r){(t=t.script.marble).row=e,t.col=i,t.isSet=r},gl.prototype.calculateMiddleBlock=function(t,e){t=t.script.gridBlock;var i=0,r=0;return i=(e=e.script.gridBlock).row>t.row?t.row+1:e.row<t.row?e.row+1:e.row,r=e.col>t.col?t.col+1:e.col<t.col?e.col+1:e.col,this.gridBlocks[i][r]},gl.prototype.checkIf2SpotsAway=function(t,e){return t=t.script.gridBlock,(e=e.script.gridBlock).row===t.row&&2===Math.abs(e.col-t.col)||e.col===t.col&&2===Math.abs(e.row-t.row)},gl.prototype.toggleMarbleColliders=function(t){for(let e=0;e<this.marbleInstances.length;e++)this.marbleInstances[e].script.marble.isSet&&(this.marbleInstances[e].collision.enabled=t)},gl.prototype.checkIfGridSpotUsable=function(t,e){return(0!=t||!(e<2||e>4))&&((1!=t||0!=e&&6!=e)&&((5!=t||0!=e&&6!=e)&&((6!=t||!(e<2||e>4))&&!(t<0||t>6||e<0||e>6))))},gl.prototype.marblesLeft=function(){var t=0,e=this.gridBlocks;for(let i=0;i<e.length;i++)for(let r=0;r<e[i].length;r++)e[i][r].script.gridBlock.isUsed&&t++;return t},gl.prototype.anyMovesLeft=function(){var t=this.gridBlocks;for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)if(t[e][i].script.gridBlock.isUsed&&this.checkIfGridSpotUsable(e,i)){if(this.checkIfGridSpotUsable(e-1,i)&&this.checkIfGridSpotUsable(e-2,i)&&t[e-1][i].script.gridBlock.isUsed&&!t[e-2][i].script.gridBlock.isUsed)return!0;if(this.checkIfGridSpotUsable(e+1,i)&&this.checkIfGridSpotUsable(e+2,i)&&t[e+1][i].script.gridBlock.isUsed&&!t[e+2][i].script.gridBlock.isUsed)return!0;if(this.checkIfGridSpotUsable(e,i-1)&&this.checkIfGridSpotUsable(e,i-2)&&t[e][i-1].script.gridBlock.isUsed&&!t[e][i-2].script.gridBlock.isUsed)return!0;if(this.checkIfGridSpotUsable(e,i+1)&&this.checkIfGridSpotUsable(e,i+2)&&t[e][i+1].script.gridBlock.isUsed&&!t[e][i+2].script.gridBlock.isUsed)return!0}return!1},gl.prototype.debugGridBlocks=function(){var t=this.gridBlocks;for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)t[e][i].script.gridBlock.isUsed&&t[e][i].script.gridBlock.isUsable?t[e][i].render.enabled=!0:t[e][i].render.enabled=!1},gl.prototype.turnOffGridBlocksVisibility=function(){var t=this.gridBlocks;for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)this.toggleGridBlockChildren(t[e][i],!1)},gl.prototype.doRaycast=function(t,e){var i=this.mainCam.getPosition(),r=this.mainCam.camera.screenToWorld(t,e,this.mainCam.camera.farClip),s=this.app.systems.rigidbody.raycastFirst(i,r),o="non-interactive";return null!=s&&s.entity.script?s.entity.script.marble?o="marble":s.entity.script.gridBlock&&(o="gridBlock"):o="no contact",{result:s,type:o}},gl.prototype.onMouseUp=function(t){this.firstMoveMade?this.states.event(this,"clickReleased"):this.states.event(this,"gameStartClickReleased")},gl.prototype.onMouseDown=function(t){if(t.button===pc.MOUSEBUTTON_LEFT)switch(this.mouseClickRaycastResult=this.doRaycast(t.x,t.y),this.mouseClickRaycastResult.type){case"marble":this.clickedMarble=this.mouseClickRaycastResult.result.entity,this.lastBlock=this.gridBlocks[this.clickedMarble.script.marble.row][this.clickedMarble.script.marble.col],this.states.event(this,"marbleClicked");break;case"gridBlock":this.states.event(this,"gridClicked");break;case"emptySpot":this.states.event(this,"emptySpotClicked");break;default:this.states.event(this,"bgClicked")}t.button===pc.MOUSEBUTTON_MIDDLE&&console.log("middle mouse button clicked"),t.button===pc.MOUSEBUTTON_RIGHT&&console.log("right mouse button clicked")},gl.prototype.onMouseMove=function(t){this.storeAPosition=new pc.Vec3;this.app.root.findByName("Camera");this.someNewPosition=this.mainCam.camera.screenToWorld(t.x,t.y,10,this.storeAPosition),this.mousePos=[t.x,t.y]},gl.prototype.initialize=function(){this.setupAndLocalVariables(),this.turnOffGridBlocksVisibility(),this.app.mouse.disableContextMenu(),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this)},gl.prototype.update=function(t){switch(this.states.state){case"gameStart":this.states.gameStart.actions.onUpdate(this);break;case"idle":this.states.idle.actions.onUpdate(this);break;case"rotateView":case"victory":case"noMoreMoves":break;case"marbleSelected":this.states.marbleSelected.actions.onUpdate(this);break;default:console.log("something aint right")}};var ml=pc.createScript("marble");ml.prototype.initialize=function(){this.id=-1,this.col=-1,this.row=-1,this.isSet=!1,this.isGrabbed=!1},ml.prototype.update=function(t){};var Raycast=pc.createScript("raycast");Raycast.prototype.initialize=function(){this.entity.camera?(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.mouseDown,this),this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,this.touchStart,this)):console.error("This script must be applied to an entity with a camera component.")},Raycast.prototype.mouseDown=function(t){this.doRaycast(t.x,t.y)},Raycast.prototype.touchStart=function(t){1===t.touches.length&&this.doRaycast(t.touches[0].x,t.touches[0].y),t.event.preventDefault()},Raycast.prototype.doRaycast=function(t,a){var o=this.entity.getPosition(),e=this.entity.camera.screenToWorld(t,a,this.entity.camera.farClip),s=this.app.systems.rigidbody.raycastFirst(o,e);if(s){var i=s.entity;console.log("You selected "+i.name)}};var HideAtlaunch=pc.createScript("hideAtlaunch");HideAtlaunch.prototype.initialize=function(){this.entity.enabled=!1},HideAtlaunch.prototype.update=function(t){};var GridBlock=pc.createScript("gridBlock");GridBlock.prototype.initialize=function(){this.isUsed=!1,this.isUsable=!1,this.marbleId=-1,this.col=-1,this.row=-1},GridBlock.prototype.update=function(i){};var PlatformCollider=pc.createScript("platformCollider");PlatformCollider.prototype.initialize=function(){},PlatformCollider.prototype.update=function(o){};var History=pc.createScript("history");History.prototype.initialize=function(){},History.prototype.update=function(t){};

//# sourceMappingURL=__game-scripts.js.map